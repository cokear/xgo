name: Streamlit è‡ªåŠ¨å”¤é†’

on:
  workflow_dispatch:          # å…è®¸æ‰‹åŠ¨æŒ‰é’®è§¦å‘
  repository_dispatch:        # å…è®¸ Webhook è§¦å‘
    types: [service-down-alert]

jobs:
  wakeup:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸŒ è®¾ç½® Chrome æµè§ˆå™¨
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable

      - name: ğŸ è®¾ç½® Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: ğŸ“¦ å®‰è£…ä¾èµ–åº“
        run: |
          python -m pip install --upgrade pip
          pip install selenium webdriver-manager

      - name: ğŸš€ åˆ¤æ–­å¹¶æ‰§è¡Œ
        env:
          STREAMLIT_APP_URL: ${{ secrets.STREAMLIT_APP_URL }}
          ALARM_MSG: ${{ github.event.client_payload.message }}
          EVENT_NAME: ${{ github.event_name }}
        run: |
          # é€»è¾‘ï¼šå¦‚æœæ˜¯æ‰‹åŠ¨è§¦å‘ï¼Œæˆ–è€…æŠ¥è­¦æ¶ˆæ¯é‡ŒåŒ…å« "streamlit"ï¼Œåˆ™è¿è¡Œè„šæœ¬
          if [[ "$EVENT_NAME" == "workflow_dispatch" ]] || echo "$ALARM_MSG" | grep -iq "streamlit"; then
            echo "âœ… è§¦å‘æ¡ä»¶æ»¡è¶³ï¼Œæ­£åœ¨æ‰§è¡Œå”¤é†’è„šæœ¬..."
            
            if [ -f "keep/streamlit-keep.py" ]; then
              python keep/streamlit-keep.py
            else
              echo "âŒ é”™è¯¯: æ‰¾ä¸åˆ° keep/streamlit-keep.py æ–‡ä»¶"
              exit 1
            fi
          else
            echo "ğŸ›‘ å¿½ç•¥éç›®æ ‡æŠ¥è­¦ (æ¶ˆæ¯æœªåŒ…å« 'streamlit')"
          fi
