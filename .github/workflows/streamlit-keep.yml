jobs:
  wakeup:
    runs-on: ubuntu-latest
    # ç§»é™¤ä¹‹å‰çš„ ifï¼Œå› ä¸ºæˆ‘ä»¬è¦è¿›åˆ°æ­¥éª¤é‡Œå»æ‰“å°è°ƒè¯•
    
    steps:
      - name: ğŸ” è°ƒè¯•ä¿¡æ¯
        run: |
          echo "GitHub æ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹: '${{ github.event.client_payload.message }}'"

      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸŒ è®¾ç½® Chrome & Python & ä¾èµ–
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable
      - uses: actions/setup-python@v5
        with:
          python-version: "3.10"
      - run: |
          python -m pip install --upgrade pip
          pip install selenium webdriver-manager

      - name: ğŸš€ æ‰§è¡Œå”¤é†’
        env:
          STREAMLIT_APP_URL: ${{ secrets.STREAMLIT_APP_URL }}
          # è·å–æ¶ˆæ¯å†…å®¹
          ALARM_MSG: ${{ github.event.client_payload.message }}
        run: |
          # ã€æ ¸å¿ƒä¿®æ”¹ã€‘ä½¿ç”¨ grep æœç´¢æ¶ˆæ¯é‡Œæ˜¯å¦åŒ…å« "streamlit" (å¿½ç•¥å¤§å°å†™)
          if echo "$ALARM_MSG" | grep -iq "streamlit"; then
            echo "âœ… åœ¨æ¶ˆæ¯ä¸­æ£€æµ‹åˆ° 'streamlit'ï¼Œç¡®è®¤ä¸ºç›®æ ‡æœåŠ¡ç¦»çº¿ï¼"
            echo "æ­£åœ¨å¯åŠ¨å”¤é†’è„šæœ¬..."
            
            if [ -f "keep/streamlit-keep.py" ]; then
              python keep/streamlit-keep.py
            else
              echo "âŒ é”™è¯¯: æ‰¾ä¸åˆ°å”¤é†’è„šæœ¬"
              exit 1
            fi
            
          else
            echo "ğŸ›‘ æ¶ˆæ¯ä¸­æœªåŒ…å« 'streamlit'ï¼Œè·³è¿‡æ‰§è¡Œã€‚"
            echo "æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯: [$ALARM_MSG]"
          fi
