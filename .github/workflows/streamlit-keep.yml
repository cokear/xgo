name: streamlit自动唤醒

on:
  workflow_dispatch:
  repository_dispatch:
    types: [service-down-alert]

jobs:
  - name: 检查触发事件
    run: |
      echo "Workflow triggered by: ${{ github.event_name }}"
      if [[ "${{ github.event_name }}" == "repository_dispatch" ]]; then
        echo "触发事件类型 (Event Type): ${{ github.event.action }}"
        echo "收到来自 Uptime Kuma 的下线通知，开始执行自动恢复部署流程..."
      elif [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
        echo "工作流被手动触发，开始执行部署..."
      else
        echo "工作流由计划任务触发，开始执行部署..."
      fi

  - name: 检查主分支
    uses: actions/checkout@v4

  - name: 安装依赖
    run: |
      pip -r requirements.txt

  - name: 执行保活脚本
    run: |
      py streamlit.py
