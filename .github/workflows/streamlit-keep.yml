name: Streamlit è‡ªåŠ¨å”¤é†’ (è°ƒè¯•æ¨¡å¼)

on:
  workflow_dispatch:
  repository_dispatch:
    types: [service-down-alert]

jobs:
  wakeup:
    runs-on: ubuntu-latest
    # ã€é‡ç‚¹ã€‘æˆ‘æŠŠ if åˆ¤æ–­åˆ æ‰äº†ï¼ç°åœ¨åªè¦æœ‰é€šçŸ¥ï¼Œå®ƒå°±ä¼šè¿è¡Œï¼
    
    steps:
      - name: ğŸ” æ‰å¦–é•œ - æŸ¥çœ‹çœŸå®æ•°æ®
        run: |
          echo "========================================"
          echo "GitHub æ”¶åˆ°çš„å®Œæ•´æ•°æ®ï¼š"
          echo "ç›‘æ§åç§° (monitor_name): '${{ github.event.client_payload.monitor_name }}'"
          echo "æŠ¥è­¦æ ‡é¢˜ (title): '${{ github.event.client_payload.title }}'"
          echo "æŠ¥è­¦çŠ¶æ€ (status): '${{ github.event.client_payload.status }}'"
          echo "========================================"
          
      # ä¸ºäº†é˜²æ­¢åå­—ä¸å¯¹å¯¼è‡´è¯¯æ“ä½œï¼Œæˆ‘ä»¬åœ¨è„šæœ¬æ‰§è¡Œå‰å†åšä¸€æ¬¡æ‰‹åŠ¨æ£€æŸ¥
      - name: ğŸš€ å°è¯•æ‰§è¡Œå”¤é†’
        env:
          STREAMLIT_APP_URL: ${{ secrets.STREAMLIT_APP_URL }}
          # æŠŠæ”¶åˆ°çš„åå­—ä¼ ç»™ä¸‹ä¸€æ­¥
          RECEIVED_NAME: ${{ github.event.client_payload.monitor_name }}
        run: |
          # è¿™é‡Œç”¨ Shell è„šæœ¬åšåˆ¤æ–­ï¼Œå¦‚æœä¸åŒ¹é…æ‰“å°å‡ºæ¥è®©æˆ‘ä»¬çœ‹åˆ°
          if [[ "$RECEIVED_NAME" == "streamlit" ]]; then
             echo "âœ… åå­—å®Œå…¨åŒ¹é…ï¼Œå¼€å§‹æ‰§è¡Œ Python è„šæœ¬..."
             # æ­¤å¤„ä¸ºäº†è°ƒè¯•ï¼Œå…ˆä¸çœŸçš„è¿è¡Œï¼Œæˆ–è€…ä½ å¯ä»¥ä¿ç•™è¿è¡Œ
             # python keep/streamlit-keep.py
          else
             echo "âŒ åå­—ä¸åŒ¹é…ï¼"
             echo "Komari å‘æ¥çš„åå­—æ˜¯: [$RECEIVED_NAME]"
             echo "GitHub ç­‰å¾…çš„åå­—æ˜¯: [streamlit]"
             echo "è¯·å»ä¿®æ”¹ Komari ç›‘æ§é¡¹åç§°ï¼Œæˆ–è€…ä¿®æ”¹ YAML é‡Œçš„åˆ¤æ–­æ¡ä»¶ã€‚"
          fi
